{"title":"Python 爬虫实现天气查询（可视化界面版）","slug":"Python-tianqi","date":"2018-09-02T02:37:29.000Z","updated":"2018-09-02T02:59:25.582Z","comments":true,"path":"api/articles/Python-tianqi.json","photos":[],"link":"","excerpt":"Python 实现天气查询的程序早已完成，近日开学无课，昨晚心血来潮想做一个较为友好的界面版本，便匆忙行动了起来。在之前已有的程序的基础上使用Tkinter 模块实现GUI 并不是很难，但是在做的过程中《我的英雄学院》更新了，所以中途耽误了，今天早上才做好。（~.~）<br>","covers":["/static/images/python/tianqi.png","/static/images/python/tianqi1.png"],"content":"<p>Python 实现天气查询的程序早已完成，近日开学无课，昨晚心血来潮想做一个较为友好的界面版本，便匆忙行动了起来。</p>\n<p>在之前已有的程序的基础上使用Tkinter 模块实现GUI 并不是很难，但是在做的过程中《我的英雄学院》更新了，所以中途耽误了，今天早上才做好。（~.~）<br><a id=\"more\"></a>  </p>\n<p>代码的主体是爬虫与Tkinter。</p>\n<p>执行程序后会先出现一个选择城市的界面，这里需要输入城市名。点击确认即会出现城市天气状况。</p>\n<p>执行效果如下：</p>\n<p><img src=\"/static/images/python/tianqi.png\" alt=\"tianqi\"></p>\n<p><img src=\"/static/images/python/tianqi1.png\" alt=\"tianqi1\"></p>\n<p>源代码：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> tkinter <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> gzip</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> tkinter <span class=\"keyword\">import</span> messagebox</span><br><span class=\"line\"></span><br><span class=\"line\">root = Tk()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">\t<span class=\"comment\">#输入窗口</span></span><br><span class=\"line\">\troot.title(<span class=\"string\">'天气查询'</span>)<span class=\"comment\">#窗口标题</span></span><br><span class=\"line\">\tLabel(root,text = <span class=\"string\">'请输入城市'</span>).grid(row=<span class=\"number\">0</span>,column=<span class=\"number\">0</span>)<span class=\"comment\">#设置标签并调整位置</span></span><br><span class=\"line\">\tenter = Entry(root)<span class=\"comment\">#输入框</span></span><br><span class=\"line\">\tenter.grid(row = <span class=\"number\">0</span>,column=<span class=\"number\">1</span>,padx = <span class=\"number\">20</span>, pady = <span class=\"number\">20</span>)<span class=\"comment\">#调整位置</span></span><br><span class=\"line\">\tenter.delete(<span class=\"number\">0</span>,END)<span class=\"comment\">#清空输入框</span></span><br><span class=\"line\">\tenter.insert(<span class=\"number\">0</span>,<span class=\"string\">'湘潭'</span>)<span class=\"comment\">#设置默认文本</span></span><br><span class=\"line\">\t<span class=\"comment\">#enter_text = enter.get()#获取输入框的内容</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\trunning = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_weather_data</span><span class=\"params\">()</span> :</span><span class=\"comment\">#获取网站数据</span></span><br><span class=\"line\">\t\tcity_name = enter.get()<span class=\"comment\">#获取输入框的内容</span></span><br><span class=\"line\">\t\turl1 = <span class=\"string\">'http://wthrcdn.etouch.cn/weather_mini?city='</span>+urllib.parse.quote(city_name)</span><br><span class=\"line\">\t\turl2 = <span class=\"string\">'http://wthrcdn.etouch.cn/weather_mini?citykey=101010100'</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#网址1只需要输入城市名，网址2需要输入城市代码</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#print(url1)</span></span><br><span class=\"line\">\t\tweather_data = urllib.request.urlopen(url1).read()</span><br><span class=\"line\">\t\t<span class=\"comment\">#读取网页数据</span></span><br><span class=\"line\">\t\tweather_data = gzip.decompress(weather_data).decode(<span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">#解压网页数据</span></span><br><span class=\"line\">\t\tweather_dict = json.loads(weather_data)</span><br><span class=\"line\">\t\t<span class=\"comment\">#将json数据转换为dict数据</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> weather_dict.get(<span class=\"string\">'desc'</span>) == <span class=\"string\">'invilad-citykey'</span>:</span><br><span class=\"line\">\t\t\tprint(messagebox.askokcancel(<span class=\"string\">\"xing\"</span>,<span class=\"string\">\"你输入的城市名有误，或者天气中心未收录你所在城市\"</span>))</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span>:</span><br><span class=\"line\">\t\t\t<span class=\"comment\">#print(messagebox.askokcancel('xing','bingguo'))</span></span><br><span class=\"line\">\t\t\tshow_data(weather_dict,city_name)</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show_data</span><span class=\"params\">(weather_dict,city_name)</span>:</span><span class=\"comment\">#显示数据</span></span><br><span class=\"line\">\t\tforecast = weather_dict.get(<span class=\"string\">'data'</span>).get(<span class=\"string\">'forecast'</span>)<span class=\"comment\">#获取数据块</span></span><br><span class=\"line\">\t\troot1=Tk()<span class=\"comment\">#副窗口</span></span><br><span class=\"line\">\t\troot1.geometry(<span class=\"string\">'650x280'</span>)<span class=\"comment\">#修改窗口大小</span></span><br><span class=\"line\">\t\troot1.title(city_name + <span class=\"string\">'天气状况'</span>)<span class=\"comment\">#副窗口标题</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">#设置日期列表</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">5</span>):<span class=\"comment\">#将每一天的数据放入列表中</span></span><br><span class=\"line\">\t\t\tLANGS = [(forecast[i].get(<span class=\"string\">'date'</span>),<span class=\"string\">'日期'</span>),</span><br><span class=\"line\">\t\t\t\t\t\t(forecast[i].get(<span class=\"string\">'fengxiang'</span>),<span class=\"string\">'风向'</span>),</span><br><span class=\"line\">\t\t\t\t\t\t(str(forecast[i].get(<span class=\"string\">'fengji'</span>)),<span class=\"string\">'风级'</span>),</span><br><span class=\"line\">\t\t\t\t\t\t(forecast[i].get(<span class=\"string\">'high'</span>),<span class=\"string\">'最高温'</span>),</span><br><span class=\"line\">\t\t\t\t\t\t(forecast[i].get(<span class=\"string\">'low'</span>),<span class=\"string\">'最低温'</span>),</span><br><span class=\"line\">\t\t\t\t\t\t(forecast[i].get(<span class=\"string\">'type'</span>),<span class=\"string\">'天气'</span>)]</span><br><span class=\"line\">\t\t\tgroup = LabelFrame(root1,text = <span class=\"string\">'天气状况'</span>,padx = <span class=\"number\">0</span>,pady = <span class=\"number\">0</span>)<span class=\"comment\">#框架</span></span><br><span class=\"line\">\t\t\tgroup.pack(padx=<span class=\"number\">11</span>,pady=<span class=\"number\">0</span>,side = LEFT)<span class=\"comment\">#放置框架</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> lang, value <span class=\"keyword\">in</span> LANGS:<span class=\"comment\">#将数据放入框架中</span></span><br><span class=\"line\">\t\t\t\tc = Label(group,text = value + <span class=\"string\">': '</span> + lang)</span><br><span class=\"line\">\t\t\t\tc.pack(anchor = W)</span><br><span class=\"line\">\t\tLabel(root1,text = <span class=\"string\">'今日'</span> + weather_dict.get(<span class=\"string\">'data'</span>).get(<span class=\"string\">'ganmao'</span>),</span><br><span class=\"line\">\t\t\t\tfg = <span class=\"string\">'green'</span>).place(x=<span class=\"number\">40</span>,y=<span class=\"number\">20</span>,height=<span class=\"number\">40</span>)<span class=\"comment\">#温馨提示</span></span><br><span class=\"line\">\t\tLabel(root1,text = <span class=\"string\">\"StarMan: 49star.com\"</span>,fg = <span class=\"string\">\"green\"</span>,bg = <span class=\"string\">\"yellow\"</span>).place(x=<span class=\"number\">10</span>,y=<span class=\"number\">255</span>,width=<span class=\"number\">125</span>,height=<span class=\"number\">20</span>)<span class=\"comment\">#作者网站</span></span><br><span class=\"line\">\t\tButton(root1,text = <span class=\"string\">'确认并退出'</span>,width=<span class=\"number\">10</span>,command = root1.quit).place(x=<span class=\"number\">500</span>,y=<span class=\"number\">230</span>,width = <span class=\"number\">80</span>,height=<span class=\"number\">40</span>)<span class=\"comment\">#退出按钮</span></span><br><span class=\"line\">\t\troot1.mainloop()</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">#布置按键\t</span></span><br><span class=\"line\">\tButton(root, text = <span class=\"string\">\"确认\"</span>,width=<span class=\"number\">10</span>,command = get_weather_data)\\</span><br><span class=\"line\">\t\t\t.grid(row = <span class=\"number\">3</span>, column=<span class=\"number\">0</span>,sticky = W, padx = <span class=\"number\">10</span>, pady = <span class=\"number\">5</span>)</span><br><span class=\"line\">\tButton(root, text = <span class=\"string\">'退出'</span>,width=<span class=\"number\">10</span>,command = root.quit)\\</span><br><span class=\"line\">\t\t\t.grid(row = <span class=\"number\">3</span>, column = <span class=\"number\">1</span>, sticky = E, padx = <span class=\"number\">10</span>, pady = <span class=\"number\">5</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> running==<span class=\"number\">1</span>:</span><br><span class=\"line\">\t\troot.mainloop()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">\tmain()</span><br></pre></td></tr></table></figure></p>\n<p>今天海贼王更新！！共勉！</p>\n","categories":[{"name":"Python","slug":"Python","count":4,"path":"api/categories/Python.json"}],"tags":[{"name":"Python","slug":"Python","count":4,"path":"api/tags/Python.json"}]}